"use strict";(self.webpackChunkpublic_documentation=self.webpackChunkpublic_documentation||[]).push([[4936],{5215:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=s(4848),t=s(8453);const r={sidebar_label:"CLI",id:"cli-security-guide",title:"Security With the CLI",description:"A guide to securing the Codiac platform.",tags:["Intro","Getting started"]},o=void 0,a={id:"guides/security/cli-security-guide",title:"Security With the CLI",description:"A guide to securing the Codiac platform.",source:"@site/docs/guides/security/cli-security-guide.md",sourceDirName:"guides/security",slug:"/guides/security/cli-security-guide",permalink:"/docs/guides/security/cli-security-guide",draft:!1,unlisted:!1,tags:[{label:"Intro",permalink:"/docs/tags/intro"},{label:"Getting started",permalink:"/docs/tags/getting-started"}],version:"current",frontMatter:{sidebar_label:"CLI",id:"cli-security-guide",title:"Security With the CLI",description:"A guide to securing the Codiac platform.",tags:["Intro","Getting started"]},sidebar:"tutorialSidebar",previous:{title:"Upgrade Cluster Version",permalink:"/docs/guides/manage/upgrade-cluster-version-guide"},next:{title:"Existing Telemetry",permalink:"/docs/guides/telemetry/existing-telemetry-guide"}},l={},c=[{value:"The Built-in Administrator Role",id:"the-built-in-administrator-role",level:3},{value:"Authenticate",id:"authenticate",level:3},{value:"Role Based Access Control (RBAC)",id:"role-based-access-control-rbac",level:3},{value:"Managing Roles",id:"managing-roles",level:3},{value:"Assigning Roles to Users",id:"assigning-roles-to-users",level:3},{value:"Protecting Entities",id:"protecting-entities",level:3},{value:"Roles vs Users",id:"roles-vs-users",level:3},{value:"Setting Default Permissions",id:"setting-default-permissions",level:3},{value:"Conclusion",id:"conclusion",level:3}];function d(e){const n={code:"code",em:"em",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["When you want to limit access to various parts of your enterprise,\nthe ",(0,i.jsx)(n.code,{children:"cod auth"})," commands provide a means by which you can manage roles and users, and apply privileges to roles on the various environments and cabinets in your enterprise."]}),"\n",(0,i.jsx)(n.p,{children:"for a summary of the commands in the auth module..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth --help\n"})}),"\n",(0,i.jsx)(n.h3,{id:"the-built-in-administrator-role",children:"The Built-in Administrator Role"}),"\n",(0,i.jsxs)(n.p,{children:["Your user account must have the ",(0,i.jsx)(n.code,{children:"adminstrator"})," role assigned to it to run any commands in the ",(0,i.jsx)(n.code,{children:"cod auth"})," module."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"administrator"})," role is built-in and is automatically granted universal access in your organization.   It gets automatically assigned to the user who originally created your organization in Codiac."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"You can assign this role to any user you see fit,"}),"\n",(0,i.jsx)(n.li,{children:"you cannot delete it,"}),"\n",(0,i.jsxs)(n.li,{children:["and you cannot un-assign it from the only user that has it assigned ",(0,i.jsx)(n.em,{children:"(in that scenario, you must first assign it to another user so that your organization is never left without an administrator)"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To check if you're an administrator, you'll need to authenticate..."}),"\n",(0,i.jsx)(n.h3,{id:"authenticate",children:"Authenticate"}),"\n",(0,i.jsx)(n.p,{children:"First make sure you can log in and out of the system using..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod login\ncod logout\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once logged in you can look at which roles you have assigned..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod whoami\n"})}),"\n",(0,i.jsx)(n.h3,{id:"role-based-access-control-rbac",children:"Role Based Access Control (RBAC)"}),"\n",(0,i.jsx)(n.p,{children:"The Codiac RBAC model works like this:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["There's a user and an entity.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.em,{children:["For example: the user ",(0,i.jsx)(n.code,{children:"joe-cool@yourcompany.com"})," and the cabinet ",(0,i.jsx)(n.code,{children:"dev"})]}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The user has one or more ",(0,i.jsx)(n.strong,{children:"roles"})," assigned","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.em,{children:["For example: the user ",(0,i.jsx)(n.code,{children:"joe-cool@yourcompany.com"}),"is assigned the roles of ",(0,i.jsx)(n.code,{children:"developer"})," and ",(0,i.jsx)(n.code,{children:"manager"})]}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Roles get ",(0,i.jsx)(n.strong,{children:"privileges"})," granted on entities (like cabinets)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsxs)(n.em,{children:["For example: eg: the ",(0,i.jsx)(n.code,{children:"developer"})," role has ",(0,i.jsx)(n.code,{children:"read, update, delete"})," privileges granted on the ",(0,i.jsx)(n.code,{children:"dev"})," cabinet"]})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"THEN when a user attempts to perform an action, Codiac enforces the need for that user to have a role that has been granted that privilege on the entity."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"managing-roles",children:"Managing Roles"}),"\n",(0,i.jsx)(n.p,{children:"First let's see what roles you already have in your organization..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth role list\n"})}),"\n",(0,i.jsx)(n.p,{children:"Create a developer role..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod role create developer\n"})}),"\n",(0,i.jsx)(n.p,{children:"Create a manager role..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod role create developer\n"})}),"\n",(0,i.jsx)(n.p,{children:"Create a tester role..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod role create testhair\n"})}),"\n",(0,i.jsx)(n.p,{children:"Oops! Misspelled that one...  Role names are immutable, so you'll need to delete that one and create another"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod role delete testhair\ncod role create tester\n"})}),"\n",(0,i.jsx)(n.h3,{id:"assigning-roles-to-users",children:"Assigning Roles to Users"}),"\n",(0,i.jsx)(n.p,{children:"Lets take a look at your current users and what roles they have currently assigned..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth user list\n"})}),"\n",(0,i.jsx)(n.p,{children:"To add another user to your organization:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth user invite -e sally.cool@yourcompany.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now assign the developer role to that user:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth role assign -r developer -u sally.cool@yourcompany.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also invite and assign in the same step:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth user invite -e dillon.slick@yourcompany.com -r developer \n"})}),"\n",(0,i.jsx)(n.p,{children:"To unassign a role from a user:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth role unassign -r developer -u dillon.slick@yourcompany.com\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"NOTE: Users will need to log out and log back in for user role assignments to take effect."})})}),"\n",(0,i.jsx)(n.h3,{id:"protecting-entities",children:"Protecting Entities"}),"\n",(0,i.jsx)(n.p,{children:"You can limit access to a given enterprise, environment, or cabinet by declaring privileges on it for a given role."}),"\n",(0,i.jsx)(n.p,{children:"The enterprise lives at the top of the heap so we'll need to provide read access to that in order for users to see enything else inside it, so lets do that for our 2 roles:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enteprise allow -r developer -p read\ncod auth enteprise allow -r tester -p read\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Check out the help for that command (",(0,i.jsx)(n.code,{children:"cod auth enterprise allow --help"}),") and you'll see that the ",(0,i.jsx)(n.code,{children:"-p"}),' flag declares the "Privilege" for that role on that entity.']}),"\n",(0,i.jsxs)(n.p,{children:["For instance, let's give the ",(0,i.jsx)(n.code,{children:"developer"})," role the ability to read the dev environment:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enviro allow -e dev -r developer -p read\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now look at what is allowed on that environment:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enviro allowed -e dev \n"})}),"\n",(0,i.jsx)(n.p,{children:"WIth that done, let's take a look at what the developer role is currently allowed to access:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth role allowed developer\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We only just created that role, so it doesnt have much access; only the Read privilege we just granted it on the ",(0,i.jsx)(n.code,{children:"dev"})," environment."]}),"\n",(0,i.jsxs)(n.p,{children:["In fact, our ",(0,i.jsx)(n.code,{children:"developer"})," role has no access to any cabinets inside that environment... We specifically gave privileges only to modify the environment entity itself, meaning the developer cannot actually delete the environment, but these permissions do not cascade down to the cabinet."]}),"\n",(0,i.jsxs)(n.p,{children:["Give the developer the ability to modify an existing cabinet named ",(0,i.jsx)(n.code,{children:"spike"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth cabinet allow -e dev -c spike -r developer -p modify\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We can also ",(0,i.jsx)(n.strong,{children:"revoke access"})," to an individual cabinet, which removes all privileges for that role on the cabinet:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth cabinet allow -e dev -c spike -r tester -p none\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now if you log in as a user with the ",(0,i.jsx)(n.code,{children:"developer"})," role, you'll only see the ",(0,i.jsx)(n.code,{children:"dev"})," environment and the ",(0,i.jsx)(n.code,{children:"spike"})," cabinet underneath it.  Any user attempting to deploy or configure this cabinet will have to be assigned the ",(0,i.jsx)(n.code,{children:"developer"})," role to do so."]}),"\n",(0,i.jsx)(n.p,{children:"Now look at what is allowed on that cabinet:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth cabinet allowed -e dev -c spike\n"})}),"\n",(0,i.jsx)(n.h3,{id:"roles-vs-users",children:"Roles vs Users"}),"\n",(0,i.jsxs)(n.p,{children:["Remember:  Users can be assigned zero, one, or many roles.  Its the ",(0,i.jsx)(n.strong,{children:"roles"})," that are granted privileges on entities, ",(0,i.jsx)(n.strong,{children:"not"})," the users themselves."]}),"\n",(0,i.jsx)(n.h3,{id:"setting-default-permissions",children:"Setting Default Permissions"}),"\n",(0,i.jsx)(n.p,{children:"By default new cabinets copy permission set from their parent environment."}),"\n",(0,i.jsxs)(n.p,{children:["However, we may want to set specific permissions for new cabinets in a given environment that ",(0,i.jsx)(n.strong,{children:"differ from"})," those of the parent environment.  That is, perhaps we want our administrators to set up the environments, and then allow developers to create and remove cabinets at will, without the ability to change the environment itself..."]}),"\n",(0,i.jsx)(n.p,{children:"Enter Default Child Permissions."}),"\n",(0,i.jsxs)(n.p,{children:["Let's grant full permissions to the developer role on any new cabinets that get created in the ",(0,i.jsx)(n.code,{children:"dev"})," environment.  It's the same as the ",(0,i.jsx)(n.code,{children:"allow"})," command we used before, but with the additional ",(0,i.jsx)(n.code,{children:"oncabs"})," command segment:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enviro allow oncabs -e dev -r developer -p modify\n"})}),"\n",(0,i.jsx)(n.p,{children:"And now we can make the dev environment itself readonly for them:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enviro allow -e dev -r developer -p read\n"})}),"\n",(0,i.jsx)(n.p,{children:"Our default permission template for new cabinets will now show up when you look at what's allowed on that environment:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enviro allowed -e dev\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The same default permissions feature is available for environments too, we just set the permissions at the enterprise level.  Here we're allowing the ",(0,i.jsx)(n.code,{children:"manager"})," role ",(0,i.jsx)(n.code,{children:"read"})," access to all new environments by default:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enterprise allow onenvs -r manager -p read\n"})}),"\n",(0,i.jsx)(n.p,{children:"Check it out:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cod auth enterprise allowed\n"})}),"\n",(0,i.jsx)(n.p,{children:"These default child permissions will now get assigned on any new environments created in this enterprise."}),"\n",(0,i.jsx)(n.h3,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"That might have been a lengthy walk-through, but it really boils down to only a few main concepts:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Assign roles to users (changes require users to log in again)"}),"\n",(0,i.jsx)(n.li,{children:"Assign permissions (roles + privileges) to entities (enterprise, enviro, cab) (no logout required)"}),"\n",(0,i.jsx)(n.li,{children:"Set default child permissions as a template to be applied to future environments and cabinets."}),"\n",(0,i.jsxs)(n.li,{children:["use the ",(0,i.jsx)(n.code,{children:"allowed"})," commands to view access."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);